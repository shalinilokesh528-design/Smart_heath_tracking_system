{% extends 'core/base.html' %}
{% block content %}

<style>
/* ğŸŒˆ Background and Layout */
body {
    margin: 0;
    font-family: 'Segoe UI', sans-serif;
    background: linear-gradient(to right, #e0f7fa, #f1f8e9);
    color: #333;
}

/* ğŸ“¦ Container */
main {
    max-width: 1000px;
    margin: auto;
    padding: 30px;
    background-color: #ffffffdd;
    border-radius: 10px;
    box-shadow: 0 0 10px rgba(0,0,0,0.05);
}

/* ğŸ§¾ Section Headings */
h2, h3 {
    text-align: center;
    color: #00796b;
    margin-bottom: 20px;
}

/* ğŸ” Form Styling */
form {
    margin-bottom: 20px;
}

form button {
    background-color: #00796b;
    color: white;
    padding: 6px 12px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}

form button:hover {
    background-color: #004d40;
}

/* ğŸ“Š Table Styling */
table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 30px;
}

table th, table td {
    border: 1px solid #ccc;
    padding: 10px;
    text-align: left;
}

table th {
    background-color: #e0f2f1;
    color: #004d40;
}

table tr:nth-child(even) {
    background-color: #f9f9f9;
}

table tr:hover {
    background-color: #f1f8e9;
}

/* ğŸ”— Action Links */
a {
    color: #00796b;
    text-decoration: none;
    font-weight: bold;
}

a:hover {
    text-decoration: underline;
}
</style>

<main>
  <h2>ğŸ‘¨â€âš•ï¸ Doctor Dashboard</h2>
  <p>Welcome, Dr. {{ user.get_full_name }}. This is your dashboard.</p>

  <hr>
  <!-- ğŸš¨ Emergency SOS Alerts Section -->
  {% if active_sos_alerts %}
  <div style="margin: 20px 0; padding: 15px; background: linear-gradient(135deg, #ff4444 0%, #cc0000 100%); border-radius: 10px; box-shadow: 0 4px 15px rgba(255, 68, 68, 0.3);">
    <h3 style="color: white; text-align: center; margin-bottom: 15px;">ğŸš¨ ACTIVE EMERGENCY ALERTS</h3>
    <table style="background-color: white; width: 100%; border-collapse: collapse;">
      <thead>
        <tr>
          <th style="padding: 10px; border: 1px solid #ccc; background-color: #ffeeee;">Patient</th>
          <th style="padding: 10px; border: 1px solid #ccc; background-color: #ffeeee;">Time</th>
          <th style="padding: 10px; border: 1px solid #ccc; background-color: #ffeeee;">Message</th>
          <th style="padding: 10px; border: 1px solid #ccc; background-color: #ffeeee;">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for alert in active_sos_alerts %}
        <tr>
          <td style="padding: 10px; border: 1px solid #ccc;"><strong>{{ alert.patient.get_full_name }}</strong><br><small>{{ alert.patient.unique_id }}</small></td>
          <td style="padding: 10px; border: 1px solid #ccc;">{{ alert.created_at|date:"d M Y, H:i:s" }}</td>
          <td style="padding: 10px; border: 1px solid #ccc;">{{ alert.message|default:"No message provided" }}</td>
          <td style="padding: 10px; border: 1px solid #ccc;">
            <form method="post" action="{% url 'acknowledge_sos_alert' alert.id %}" style="display:inline;">
              {% csrf_token %}
              <button type="submit" style="background-color: #00796b; color: white; padding: 6px 12px; border: none; border-radius: 4px; cursor: pointer; margin-right: 5px;">âœ“ Acknowledge</button>
            </form>
            <form method="post" action="{% url 'resolve_sos_alert' alert.id %}" style="display:inline;">
              {% csrf_token %}
              <button type="submit" style="background-color: #4caf50; color: white; padding: 6px 12px; border: none; border-radius: 4px; cursor: pointer;">âœ“ Resolve</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% endif %}

  {% if acknowledged_sos_alerts %}
  <h3 style="color: #00796b;">âœ“ Acknowledged SOS Alerts</h3>
  <table>
    <thead>
      <tr>
        <th>Patient</th>
        <th>Time</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for alert in acknowledged_sos_alerts %}
      <tr>
        <td>{{ alert.patient.get_full_name }}</td>
        <td>{{ alert.created_at|date:"d M Y, H:i:s" }}</td>
        <td>{{ alert.get_status_display }}</td>
        <td>
          <form method="post" action="{% url 'resolve_sos_alert' alert.id %}" style="display:inline;">
            {% csrf_token %}
            <button type="submit" style="background-color: #4caf50; color: white; padding: 6px 12px; border: none; border-radius: 4px; cursor: pointer;">âœ“ Resolve</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  <hr>
  {% endif %}

  <hr>
  <h3>ğŸ” Lookup Patient</h3>
  <p>You can search for patients by their unique ID.</p>
  <form method="post" action="{% url 'lookup_patient' %}">
      {% csrf_token %}
      {{ lookup_form.as_p }}
      <button type="submit">Search</button>
  </form>

  <hr>
  <h3>ğŸ“… Pending Appointments</h3>
  {% if pending_appointments %}
  <table>
      <thead>
          <tr>
              <th>Patient</th>
              <th>Date</th>
              <th>Time</th>
              <th>Hospital</th>
              <th>Reason</th>
              <th>Actions</th>
          </tr>
      </thead>
      <tbody>
          {% for appointment in pending_appointments %}
          <tr>
              <td>{{ appointment.patient.get_full_name }}</td>
              <td>{{ appointment.date }}</td>
              <td>{{ appointment.time }}</td>
              <td>{{ appointment.hospital.name }}</td>
              <td>{{ appointment.reason }}</td>
              <td>
                  <form method="post" action="{% url 'confirm_appointment' appointment.id %}" style="display:inline;">
                      {% csrf_token %}
                      <button type="submit">âœ… Accept</button>
                  </form>
                  <form method="post" action="{% url 'cancel_appointment' appointment.id %}" style="display:inline;">
                      {% csrf_token %}
                      <button type="submit">âŒ Cancel</button>
                  </form>
              </td>
          </tr>
          {% endfor %}
      </tbody>
  </table>
  {% else %}
  <p>No pending appointments.</p>
  {% endif %}

  <hr>
  <h3>âœ… Confirmed Appointments</h3>
  {% if confirmed_appointments %}
  <table>
      <thead>
          <tr>
              <th>Patient</th>
              <th>Date</th>
              <th>Time</th>
              <th>Hospital</th>
              <th>Reason</th>
              <th>Actions</th>
          </tr>
      </thead>
      <tbody>
          {% for appointment in confirmed_appointments %}
          <tr>
              <td>{{ appointment.patient.get_full_name }}</td>
              <td>{{ appointment.date }}</td>
              <td>{{ appointment.time }}</td>
              <td>{{ appointment.hospital.name }}</td>
              <td>{{ appointment.reason }}</td>
              <td>
                  <form method="post" action="{% url 'log_visit_by_id' appointment.id %}" style="display:inline;">
                      {% csrf_token %}
                      <button type="submit">ğŸ‘¨â€âš•ï¸ Visited</button>
                  </form>
              </td>
          </tr>
          {% endfor %}
      </tbody>
  </table>
  {% else %}
  <p>No confirmed appointments.</p>
  {% endif %}

  <hr>
  <h3>ğŸ“‹ Recent Patient Visits</h3>
  {% if visit_records %}
  <table>
      <thead>
          <tr>
              <th>Patient</th>
              <th>Date</th>
              <th>Hospital</th>
              <th>Status</th>
              <th>Score</th>
              <th>Notes</th>
              <th>Actions</th>
          </tr>
      </thead>
      <tbody>
          {% for visit in visit_records %}
          <tr>
              <td>{{ visit.patient.get_full_name }}</td>
              <td>{{ visit.visit_date|date:"d M Y" }}</td>
              <td>{{ visit.hospital_name }}</td>
              <td>{{ visit.current_status }}</td>
              <td>{{ visit.improvement_score }}%</td>
              <td>{{ visit.doctor_notes|truncatewords:10 }}</td>
              <td>
                  <a href="{% url 'update_visit_record' visit.id %}">ğŸ“ Update</a>
              </td>
          </tr>
          {% endfor %}
      </tbody>
  </table>
  {% else %}
  <p>No recent visits found.</p>
  {% endif %}
</main>

{% endblock %}
